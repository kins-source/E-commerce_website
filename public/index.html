<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecom Shopy  | Advanced Shopping Experience</title>
    <meta name="description" content="Shop 250+ premium products with lightning-fast delivery and modern design.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        
        :root {
            --primary: #754b91; 
            --primary-dark: #E48700;
            --dark-header: #004e92; /* NEW: Dark Blue */
            --nav-bg: #002f6c; /* NEW: Deep Navy Blue */
            --bg-page: #EAEDED; /* Amazon Background */
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-page);
            color: #1F2937; /* Gray-900 */
        }

        /* Utility Classes for App Pages */
        .page {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease-out;
        }
        .page.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Header Specific Styles */
        .header-content-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
            padding: 0.75rem 0;
        }

        /* Cart Badge Pulse Animation */
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 153, 0, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(255, 153, 0, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 153, 0, 0); }
        }
        .cart-count-badge {
            animation: pulse 2s infinite;
        }

        /* Hero Slider Custom Overrides */
        .hero-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        .hero-slide.active {
            opacity: 1;
        }
        .hero-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Countdown Custom Styling */
        .countdown-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 3rem;
        }

        /* Toast Styles (Dynamically injected but defined here for completeness) */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 350px;
            padding: 16px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .toast.show { transform: translateX(0); }
        .toast.hide { transform: translateX(100%); opacity: 0; }
        .toast.success { background: #10B981; }
        .toast.error { background: #EF4444; }
        .toast.warning { background: #F59E0B; }
        .toast.info { background: #3B82F6; }

        /* Hide Quantity Input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }

        /* Move inline modal visibility into CSS to avoid inline styles */
        .modal {
            display: none;
        }
        
    </style>
</head>
<body>

    <!-- Header - Amazon/Flipkart Style -->
    <header class="sticky top-0 z-50 shadow-md bg-white">
        <!-- Header Top -->
        <div class="bg-[--dark-header] text-white text-xs py-1.5 hidden sm:block">
            <div class="max-w-7xl mx-auto px-4 flex justify-between">
                <span class="delivery-text">ðŸšš Free delivery on orders over $50</span>
                <span class="welcome-text">Hello, <span id="user-display-name" onclick="showAuthModal()" class="cursor-pointer hover:text-yellow-400">Sign in</span></span>
            </div>
        </div>
        
        <!-- Header Main -->
        <div class="bg-[--nav-bg] px-4">
            <div class="max-w-7xl mx-auto header-content-main">
                <div class="logo flex-shrink-0">
                    <h1 class="text-2xl font-extrabold text-[--primary] cursor-pointer" onclick="navigateTo('home')">Ecom Shopy</h1>
                </div>
                
                <!-- Delivery Location (Mobile Hidden) -->
                <div class="header-icon-item hidden lg:flex items-center gap-1.5 cursor-pointer text-white hover:border border-transparent hover:border-white p-1.5 rounded-sm">
                    <i class="fas fa-map-marker-alt text-lg"></i>
                    <div class="flex flex-col text-xs">
                        <span class="text-gray-300">Deliver to</span>
                        <strong class="font-bold">India</strong>
                    </div>
                </div>

                <!-- Search Container -->
                <div class="search-container flex-grow max-w-2xl mx-auto hidden sm:flex">
                    <select class="search-category bg-gray-200 text-gray-700 p-2 border-r border-gray-300 rounded-l-md text-sm cursor-pointer hover:bg-gray-300 flex-shrink-0" title="l">
                        <option>All Departments</option>
                        <option>Electronics</option>
                        <option>Clothing</option>
                        <option>Home & Kitchen</option>
                    </select>
                    <div class="search-box flex flex-grow">
                        <input type="text" placeholder="Search EcomShopy " id="search-input" class="flex-grow p-2 text-base focus:outline-none focus:ring-4 focus:ring-yellow-500/50">
                        <button class="search-button bg-[--primary] text-[--dark-header] border-none p-2 w-10 flex items-center justify-center rounded-r-md cursor-pointer hover:bg-[--primary-dark]" title="m">
                            <i class="fas fa-search text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Header Icons -->
                <div class="header-icons flex items-center gap-4 text-white">
                    <div class="header-icon-item user-account relative group cursor-pointer" id="user-account">
                        <div class="flex items-center gap-1.5 p-1.5 rounded-sm border border-transparent hover:border-white transition-all duration-150">
                            <i class="fas fa-user text-xl"></i>
                            <div class="hidden sm:flex flex-col text-xs leading-none">
                                <span class="text-gray-300" id="account-status">Account</span>
                                <strong class="font-bold">& Lists</strong>
                            </div>
                        </div>
                        <!-- Dropdown Menu -->
                        <div class="dropdown-menu absolute top-full right-0 bg-white shadow-xl rounded-md min-w-[180px] p-2 hidden group-hover:block z-50 border border-gray-200">
                            <button id="auth-action-btn" class="w-full bg-[--primary] text-white p-2 rounded-md font-semibold mb-2 hover:bg-[--primary-dark] transition-colors" onclick="handleAuthAction()">Sign In</button>
                            <a href="#" class="block text-gray-700 p-1.5 rounded-md hover:bg-gray-100 text-sm" id="profile-link" onclick="navigateTo('profile'); return false;">Your Profile</a>
                            <a href="#" class="block text-gray-700 p-1.5 rounded-md hover:bg-gray-100 text-sm" id="orders-link">Your Orders</a>
                            <a href="#" class="block text-gray-700 p-1.5 rounded-md hover:bg-gray-100 text-sm" id="cart-link" onclick="navigateTo('cart'); return false;">Your Cart</a>
                            <a href="#" class="block text-gray-700 p-1.5 rounded-md hover:bg-gray-100 text-sm hidden" id="logout-link" onclick="store.logout(); return false;">Sign Out</a>
                        </div>
                    </div>
                    
                    <div class="header-icon-item cart-icon relative cursor-pointer" id="cart-icon" onclick="navigateTo('cart')">
                        <div class="p-1.5 rounded-sm border border-transparent hover:border-white transition-all duration-150">
                            <i class="fas fa-shopping-cart text-2xl"></i>
                            <span class="cart-count-badge absolute -top-1 -right-1.5 bg-red-600 text-white w-5 h-5 flex items-center justify-center text-xs font-bold rounded-full">0</span>
                        </div>
                        <div class="hidden sm:block text-xs font-bold mt-1 leading-none">
                            Cart
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Header Navigation (Amazon-style quick links) -->
        <div class="bg-[--nav-bg] text-white text-sm py-1.5 overflow-x-auto scrollbar-hide">
            <div class="max-w-7xl mx-auto px-4 flex gap-4 whitespace-nowrap">
                <div class="nav-category-item flex items-center gap-1.5 cursor-pointer p-1 rounded hover:bg-gray-700 transition-colors">
                    <i class="fas fa-bars"></i>
                    <span class="font-bold">All</span>
                </div>
                <div class="nav-category-item flex items-center gap-1.5 cursor-pointer p-1 rounded hover:bg-gray-700 transition-colors">
                    <i class="fas fa-bolt text-yellow-500"></i>
                    <span>Today's Deals</span>
                </div>
                <div class="nav-category-item flex items-center gap-1.5 cursor-pointer p-1 rounded hover:bg-gray-700 transition-colors">
                    <i class="fas fa-truck"></i>
                    <span>Premium Delivery</span>
                </div>
                <div class="nav-category-item flex items-center gap-1.5 cursor-pointer p-1 rounded hover:bg-gray-700 transition-colors" onclick="filterCategory('Electronics')">
                    <i class="fas fa-laptop"></i>
                    <span>Electronics</span>
                </div>
                <div class="nav-category-item flex items-center gap-1.5 cursor-pointer p-1 rounded hover:bg-gray-700 transition-colors" onclick="filterCategory('Clothing')">
                    <i class="fas fa-tshirt"></i>
                    <span>Fashion</span>
                </div>
                <div class="nav-category-item flex items-center gap-1.5 cursor-pointer p-1 rounded hover:bg-gray-700 transition-colors" onclick="filterCategory('Books')">
                    <i class="fas fa-book"></i>
                    <span>Books</span>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->

    <!-- Home Page (Incorporates user's new advanced layout) -->
    <div id="home" class="page active">
        
        <!-- Hero Banner - Dynamic Slider -->
        <section class="hero-banner relative max-w-7xl mx-auto mt-4 md:mt-6 rounded-xl overflow-hidden shadow-xl h-[400px] md:h-[500px] lg:h-[600px] bg-gray-200">
            <div class="hero-slider absolute inset-0">
                 <div class="hero-slide">
                    <img src="https://images.unsplash.com/photo-1556228453-efd6c1ff04f6?q=80&w=1920&h=600&auto=format" onerror="this.onerror=null; this.src='https://placehold.co/1920x600/232F3E/FF9900?text=Home+Essentials';" alt="Home & Kitchen">
                    <div class="hero-content absolute top-1/2 left-5 md:left-12 -translate-y-1/2 text-white p-4 rounded-lg bg-black/30 backdrop-blur-sm">
                        <h2 class="text-4xl md:text-5xl font-extrabold mb-3 drop-shadow-lg">Home Essentials</h2>
                        <p class="text-lg md:text-xl mb-6">Everything for your dream home, starting at $19.99.</p>
                        <button class="btn bg-[--primary] text-[--dark-header] p-3 md:p-4 rounded-lg font-bold hover:bg-[--primary-dark] transition-colors" onclick="filterCategory('Home & Kitchen')">Discover More</button>
                    </div>
                </div>
                <div class="hero-slide active">
                    <img src="https://images.unsplash.com/photo-1607082350899-7e105aa886ae?q=80&w=1920&h=600&auto=format" onerror="this.onerror=null; this.src='https://placehold.co/1920x600/131921/ff9900?text=Electronics+Sale';" alt="Premium Electronics">
                    <div class="hero-content absolute top-1/2 left-5 md:left-12 -translate-y-1/2 text-white p-4 rounded-lg bg-black/30 backdrop-blur-sm">
                        <h2 class="text-4xl md:text-5xl font-extrabold mb-3 drop-shadow-lg">Electronics Sale</h2>
                        <p class="text-lg md:text-xl mb-6">Up to 50% off on premium tech gear. Limited time offer!</p>
                        <button class="btn bg-[--primary] text-[--dark-header] p-3 md:p-4 rounded-lg font-bold hover:bg-[--primary-dark] transition-colors" onclick="filterCategory('Electronics')">Shop Now</button>
                    </div>
                </div>
                <div class="hero-slide">
                    <img src="https://images.unsplash.com/photo-1523381215938-3bb7444e9e96?q=80&w=1920&h=600&auto=format" onerror="this.onerror=null; this.src='https://placehold.co/1920x600/ff9900/131921?text=Summer+Fashion';" alt="Fashion Collection">
                    <div class="hero-content absolute top-1/2 left-5 md:left-12 -translate-y-1/2 text-white p-4 rounded-lg bg-black/30 backdrop-blur-sm">
                        <h2 class="text-4xl md:text-5xl font-extrabold mb-3 drop-shadow-lg">Summer Fashion</h2>
                        <p class="text-lg md:text-xl mb-6">New arrivals with free shipping on all orders over $75.</p>
                        <button class="btn bg-white text-[--nav-bg] p-3 md:p-4 rounded-lg font-bold hover:bg-gray-200 transition-colors" onclick="filterCategory('Clothing')">Explore Collection</button>
                    </div>
                </div>
               
            </div>
            <div class="hero-dots absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 z-10">
                <span class="dot w-3 h-3 bg-white/50 rounded-full cursor-pointer transition-colors active:bg-white" data-slide="0"></span>
                <span class="dot w-3 h-3 bg-white/50 rounded-full cursor-pointer transition-colors" data-slide="1"></span>
                <span class="dot w-3 h-3 bg-white/50 rounded-full cursor-pointer transition-colors" data-slide="2"></span>
            </div>
        </section>

        <!-- Deals of the Day - Flipkart Style -->
        <section class="deals-section max-w-7xl mx-auto my-12 md:my-16 px-4">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <h2 class="text-3xl font-extrabold text-gray-800">Flash Deals of the Day</h2>
                <div class="countdown-timer flex gap-3 bg-red-600 text-white p-2.5 rounded-lg shadow-md mt-3 md:mt-0">
                    <span class="text-base font-bold">ENDS IN:</span>
                    <span class="countdown-item">
                        <span class="countdown-number font-extrabold text-xl" id="hours">23</span>
                        <span class="countdown-label text-xs">HRS</span>
                    </span>
                    <span class="countdown-item">
                        <span class="countdown-number font-extrabold text-xl">:</span>
                    </span>
                    <span class="countdown-item">
                        <span class="countdown-number font-extrabold text-xl" id="minutes">59</span>
                        <span class="countdown-label text-xs">MINS</span>
                    </span>
                    <span class="countdown-item">
                        <span class="countdown-number font-extrabold text-xl">:</span>
                    </span>
                    <span class="countdown-item">
                        <span class="countdown-number font-extrabold text-xl" id="seconds">59</span>
                        <span class="countdown-label text-xs">SECS</span>
                    </span>
                </div>
            </div>
            
            <div class="deals-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6" id="deals-container">
                <!-- Dynamic deals will be rendered here -->
            </div>
        </section>

        <!-- Featured Products - Main Grid -->
        <section class="featured-products max-w-7xl mx-auto mb-16 px-4">
            <div class="flex flex-col mb-8">
                <h2 class="text-3xl font-extrabold text-gray-800">All Products</h2>
                <div class="category-filters flex flex-wrap gap-2 mt-4">
                    <button class="category-btn bg-white border border-gray-300 text-gray-800 px-4 py-2 rounded-full text-sm font-semibold transition-all hover:bg-gray-100 active:bg-[--primary] active:text-white" data-category="all">All Products</button>
                    <button class="category-btn bg-white border border-gray-300 text-gray-800 px-4 py-2 rounded-full text-sm font-semibold transition-all hover:bg-gray-100" data-category="Electronics">Electronics</button>
                    <button class="category-btn bg-white border border-gray-300 text-gray-800 px-4 py-2 rounded-full text-sm font-semibold transition-all hover:bg-gray-100" data-category="Clothing">Clothing</button>
                    <button class="category-btn bg-white border border-gray-300 text-gray-800 px-4 py-2 rounded-full text-sm font-semibold transition-all hover:bg-gray-100" data-category="Home & Kitchen">Home & Kitchen</button>
                    <button class="category-btn bg-white border border-gray-300 text-gray-800 px-4 py-2 rounded-full text-sm font-semibold transition-all hover:bg-gray-100" data-category="Books">Books</button>
                    <button class="category-btn bg-white border border-gray-300 text-gray-800 px-4 py-2 rounded-full text-sm font-semibold transition-all hover:bg-gray-100" data-category="Beauty">Beauty</button>
                    <button class="category-btn bg-white border border-gray-300 text-gray-800 px-4 py-2 rounded-full text-sm font-semibold transition-all hover:bg-gray-100" data-category="Sports">Sports</button>
                </div>
            </div>
            
            <div class="products-grid grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6" id="products-container">
                <!-- Products loaded by JavaScript -->
            </div>
        </section>
    </div>

    <!-- Product Detail Page -->
    <div id="product" class="page max-w-7xl mx-auto my-12 px-4">
        <div class="product-detail grid grid-cols-1 lg:grid-cols-2 gap-12 bg-white p-6 md:p-10 rounded-xl shadow-lg">
            <div class="product-gallery">
                <img id="product-image" src="" alt="Product Image" class="w-full aspect-square object-cover rounded-xl shadow-md transition-transform duration-300 hover:scale-[1.01]">
            </div>
            <div class="product-details flex flex-col justify-start pt-6">
                <div class="text-sm text-gray-500 mb-2">
                    <a href="#" class="text-blue-600 hover:underline" onclick="navigateTo('home'); return false;">Home</a> / 
                    <span id="product-category-breadcrumb" class="capitalize"></span> / 
                    <span id="product-name-breadcrumb" class="font-semibold text-gray-800"></span>
                </div>
                <h1 id="product-name" class="text-4xl font-extrabold text-gray-800 mb-4"></h1>
                <div class="flex items-center justify-between mb-6 border-b pb-4">
                    <div class="flex items-center gap-2">
                        <div class="product-rating text-yellow-500 text-lg font-bold" id="product-stars"></div>
                        <span id="product-reviews" class="text-gray-500 text-sm">(0 reviews)</span>
                    </div>
                    <span id="product-category-tag" class="category-tag bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-semibold uppercase">Category</span>
                </div>
                <div class="product-price-section mb-8">
                    <span id="product-price" class="text-4xl font-extrabold text-red-600">$0.00</span>
                    <span id="product-compare-price" class="text-xl text-gray-400 line-through ml-3 hidden"></span>
                </div>
                <p id="product-description" class="text-gray-600 mb-8 leading-relaxed"></p>
                
                <div class="flex items-center gap-4 mb-8">
                    <span class="font-semibold text-gray-700">Quantity:</span>
                    <div class="quantity-selector flex items-stretch border border-gray-300 rounded-lg overflow-hidden">
                        <button class="quantity-btn w-10 h-10 flex items-center justify-center bg-gray-100 hover:bg-gray-200 text-xl font-bold transition-colors" id="decrease-qty">-</button>
                        <input type="number" id="product-quantity" class="w-12 h-10 text-center text-lg font-semibold border-x border-gray-300 focus:outline-none" min="1" value="1" title="Quantity">
                        <button class="quantity-btn w-10 h-10 flex items-center justify-center bg-gray-100 hover:bg-gray-200 text-xl font-bold transition-colors" id="increase-qty">+</button>
                    </div>
                </div>
                
                <div class="product-actions flex flex-col sm:flex-row gap-4">
                    <button class="btn bg-red-600 text-white px-8 py-3 rounded-xl font-bold flex-grow hover:bg-red-700 transition-colors shadow-md" id="add-to-cart">
                        <i class="fas fa-shopping-cart mr-2"></i> Add to Cart
                    </button>
                    <button class="btn bg-gray-200 text-gray-800 px-8 py-3 rounded-xl font-bold hover:bg-gray-300 transition-colors" onclick="navigateTo('home')">
                        <i class="fas fa-arrow-left mr-2"></i> Back to Shopping
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Page -->
    <div id="cart" class="page max-w-7xl mx-auto my-12 px-4">
        <div class="text-center mb-10">
            <h2 class="text-4xl font-extrabold text-gray-800">Your Shopping Cart</h2>
            <p id="cart-empty-message" class="hidden text-xl text-gray-500 mt-4">Your cart is empty. Start shopping now!</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                <div class="cart-items divide-y divide-gray-200" id="cart-items">
                    <!-- Cart items loaded by JavaScript -->
                </div>
            </div>
            
            <div class="cart-summary bg-white p-8 rounded-xl shadow-lg border border-gray-100 h-fit">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">Order Summary</h3>
                <div class="space-y-4 text-gray-700">
                    <div class="flex justify-between">
                        <span>Subtotal:</span>
                        <span id="cart-subtotal" class="font-medium">$0.00</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Shipping:</span>
                        <span class="font-medium text-green-600">Free</span>
                    </div>
                    <div class="flex justify-between border-b pb-4">
                        <span>Tax (8%):</span>
                        <span id="cart-tax" class="font-medium">$0.00</span>
                    </div>
                    <div class="flex justify-between text-2xl font-extrabold text-gray-800 pt-2">
                        <span>Order Total:</span>
                        <span id="cart-total">$0.00</span>
                    </div>
                </div>
                
                <div class="payment-options mt-8 border-t pt-6">
                    <h4 class="text-lg font-semibold mb-3">Payment Method</h4>
                    <div class="payment-methods space-y-3">
                        <label class="payment-method flex items-center p-3 border-2 border-gray-300 rounded-lg cursor-pointer transition-colors has-[:checked]:border-blue-600">
                            <input type="radio" name="payment" value="gpay" checked class="mr-3">
                            <div class="payment-icon flex items-center gap-2 font-semibold">
                                <i class="fab fa-google text-blue-500 text-xl"></i>
                                <span>GPay</span>
                            </div>
                        </label>
                        <label class="payment-method flex items-center p-3 border-2 border-gray-300 rounded-lg cursor-pointer transition-colors has-[:checked]:border-blue-600">
                            <input type="radio" name="payment" value="paypal" class="mr-3">
                            <div class="payment-icon flex items-center gap-2 font-semibold">
                                <i class="fab fa-paypal text-blue-800 text-xl"></i>
                                <span>PayPal</span>
                            </div>
                        </label>
                    </div>
                </div>
                
                <button class="bg-blue-600 text-white w-full py-3 rounded-xl font-bold mt-6 hover:bg-blue-700 transition-colors shadow-lg shadow-blue-500/50" id="checkout-btn">
                    <i class="fas fa-lock mr-2"></i> Secure Checkout
                </button>
            </div>
        </div>
    </div>

    <!-- Profile Page -->
    <div id="profile" class="page max-w-4xl mx-auto my-12 px-4">
        <div class="bg-white p-8 md:p-12 rounded-xl shadow-lg">
            <div class="profile-header text-center border-b pb-8 mb-8">
                <div class="w-20 h-20 mx-auto rounded-full bg-blue-600 text-white flex items-center justify-center text-3xl mb-4">
                    <i class="fas fa-user"></i>
                </div>
                <h2 class="text-3xl font-extrabold text-gray-800 mb-1">My Account</h2>
                <p id="profile-name" class="text-xl font-semibold text-gray-700"></p>
            </div>
            
            <div class="profile-content grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="profile-section space-y-4 p-6 bg-gray-50 rounded-lg border">
                    <h3 class="text-xl font-bold text-gray-800 border-b pb-2 mb-4">Details</h3>
                    <div class="flex justify-between">
                        <label class="font-semibold text-gray-600">Email:</label>
                        <span id="profile-email-info" class="text-gray-800 font-medium"></span>
                    </div>
                    <div class="flex justify-between">
                        <label class="font-semibold text-gray-600">Member Since:</label>
                        <span id="profile-join-date" class="text-gray-800 font-medium"></span>
                    </div>
                    <div class="flex justify-between">
                        <label class="font-semibold text-gray-600">Current Cart Items:</label>
                        <span id="profile-cart-count" class="text-blue-600 font-bold"></span>
                    </div>
                </div>
                
                <div class="profile-section space-y-4 p-6 bg-gray-50 rounded-lg border">
                    <h3 class="text-xl font-bold text-gray-800 border-b pb-2 mb-4">Actions</h3>
                    <button class="w-full bg-blue-600 text-white py-2.5 rounded-lg font-bold hover:bg-blue-700 transition-colors flex items-center justify-center" onclick="navigateTo('cart')">
                        <i class="fas fa-shopping-cart mr-2"></i> Go to Cart
                    </button>
                    <button class="w-full bg-red-600 text-white py-2.5 rounded-lg font-bold hover:bg-red-700 transition-colors flex items-center justify-center" id="logout-profile-btn" onclick="store.logout(); navigateTo('home')">
                        <i class="fas fa-sign-out-alt mr-2"></i> Log Out
                    </button>
                    <button class="w-full bg-gray-300 text-gray-800 py-2.5 rounded-lg font-bold hover:bg-gray-400 transition-colors flex items-center justify-center" onclick="store.clearCart()">
                        <i class="fas fa-trash-alt mr-2"></i> Clear Cart
                    </button>
    <!-- Auth Modal -->
    <div id="auth-modal" class="modal fixed inset-0 z-[1000] bg-black/70 flex items-center justify-center p-4">
        <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-md p-6 md:p-8 transform transition-transform duration-300">
            <span class="close-modal absolute top-4 right-4 text-3xl font-light text-gray-500 cursor-pointer hover:text-gray-800">&times;</span>
            <div class="auth-tabs flex border-b border-gray-200 mb-6">
                <button class="tab-btn flex-1 py-3 text-center text-lg font-semibold border-b-2 border-transparent transition-colors active:text-blue-600 active:border-blue-600" data-tab="login">Login</button>
                <button class="tab-btn flex-1 py-3 text-center text-lg font-semibold border-b-2 border-transparent transition-colors" data-tab="register">Register</button>
            </div>
            
            <div class="tab-content active" id="login-tab">
                <h2 class="text-2xl font-bold text-center mb-6">Welcome Back</h2>
                <form id="login-form" class="space-y-4">
                    <div class="form-group">
                        <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                        <input type="email" id="login-email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="login-password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-700 transition-colors mt-4">Sign In</button>
                </form>
            </div>
            
            <div class="tab-content hidden" id="register-tab">
                <h2 class="text-2xl font-bold text-center mb-6">Create Account</h2>
                <form id="register-form" class="space-y-4">
                    <div class="form-group">
                        <label for="register-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" id="register-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                        <input type="email" id="register-email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="register-password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <button type="submit" class="w-full bg-green-600 text-white p-3 rounded-lg font-bold hover:bg-green-700 transition-colors mt-4">Register</button>
                </form>
            </div>
        </div>
    </div>
                    <button type="submit" class="w-full bg-green-600 text-white p-3 rounded-lg font-bold hover:bg-green-700 transition-colors mt-4">Register</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Checkout Success Modal -->
    <div id="checkout-success" class="modal fixed inset-0 z-[1000] bg-black/70 flex items-center justify-center p-4">
        <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-md p-8 text-center transform transition-transform duration-300">
            <div class="success-icon text-green-500 text-7xl mb-4">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Order Placed!</h2>
            <p class="text-gray-600 mb-6">Your order has been confirmed and is being processed.</p>
            <div class="order-details bg-gray-100 p-4 rounded-lg space-y-2 text-left text-gray-700 mb-6">
                <p><strong>Order ID:</strong> <span id="order-id" class="float-right font-medium"></span></p>
                <p><strong>Total Amount:</strong> <span id="order-total" class="float-right font-medium"></span></p>
                <p><strong>Payment Method:</strong> <span id="order-payment" class="float-right font-medium"></span></p>
            </div>
            <button class="w-full bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-700 transition-colors" onclick="store.closeCheckoutSuccess()">Continue Shopping</button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-[--nav-bg] text-white pt-12 mt-16">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8 pb-10 border-b border-gray-700">
                <div>
                    <h4 class="text-lg font-bold mb-3">Get to Know Us</h4>
                    <ul class="space-y-1 text-sm text-gray-400">
                        <li><a href="#" class="hover:text-[--primary] transition-colors">Careers</a></li>
                        <li><a href="#" class="hover:text-[--primary] transition-colors">Blog</a></li>
                        <li><a href="#" class="hover:text-[--primary] transition-colors">About EcomShopy</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-3">Make Money</h4>
                    <ul class="space-y-1 text-sm text-gray-400">
                        <li><a href="#" class="hover:text-[--primary] transition-colors">Sell on EcomShopy</a></li>
                        <li><a href="#" class="hover:text-[--primary] transition-colors">Become an Affiliate</a></li>
                        <li><a href="#" class="hover:text-[--primary] transition-colors">Advertise Products</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-3">Payment Products</h4>
                    <ul class="space-y-1 text-sm text-gray-400">
                        <li><a href="#" class="hover:text-[--primary] transition-colors">EcomShopy Card</a></li>
                        <li><a href="#" class="hover:text-[--primary] transition-colors">Shop with Points</a></li>
                        <li><a href="#" class="hover:text-[--primary] transition-colors">Reload Balance</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-3">Let Us Help You</h4>
                    <ul class="space-y-1 text-sm text-gray-400">
                        <li><a href="#" class="hover:text-[--primary] transition-colors">Your Account</a></li>
                        <li><a href="#" class="hover:text-[--primary] transition-colors">Your Orders</a></li>
                        <li><a href="#" class="hover:text-[--primary] transition-colors">Shipping Policies</a></li>
                    </ul>
                </div>
            </div>
            <div class="text-center py-4 text-xs text-gray-500">
                <p>&copy; 2025 EcomShopy Pro, Inc. All rights reserved. | Data is stored locally on your browser.</p>
            </div>
        </div>
    </footer>

    <script>
        // Use the global window object to expose the store for easy debugging and interaction
        window.store = null; 

        // --- PRODUCT DATA DEFINITIONS (FIXED AND ENHANCED) ---
        // This is the fixed product data from your original script, slightly enhanced.
       const productDefinitions = { 
    Electronics: [
        { name: 'AuraSound Elite ANC Headphones', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSgFoJHfcSmrgR_2mg1eTxkbq6OVCz4HcqvrA&s', priceUSD: 79, comparePriceUSD: 129, description: 'Over-ear Bluetooth headphones with noise isolation and 20h battery.' },
        { name: 'SonicFlow Pro Wireless Headset', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSIdaWZXTEUGCVR-rCiiT0Eqiv28trWj2Fh-w&s', priceUSD: 99, comparePriceUSD: 149, description: 'Lightweight wireless headphones with built-in mic and comfortable fit.' },
        { name: 'NovaTech X9 128GB Smartphone', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRTZaxmUtY6xvb9Z-MmF7QMXtoRPsCQtTPQXA&s', priceUSD: 699, comparePriceUSD: 899, description: '6.5" display smartphone with multi-lens camera and 128GB storage.' },
        { name: 'ZenBook 14 Ultra-Thin Laptop', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQrGFIJ_YeN45PdjpvJI2IuwvoguqC_l4CMQA&s', priceUSD: 799, comparePriceUSD: 999, description: '14" ultrabook with SSD and 8GB RAM for portable productivity.' },
        { name: 'PulseFit Fitness Smartwatch', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRWYIbYRhkJYavARBAlWfht-yzPXusUDXfrLw&s', priceUSD: 199, comparePriceUSD: 249, description: 'Fitness-oriented smartwatch with heart-rate monitoring.' },
        { name: 'PocketBoom 10Hr Bluetooth Speaker', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTSd1rB4mD1lTCHN9L1uDFyxAThnlKBcYKxgA&s', priceUSD: 49, comparePriceUSD: 79, description: 'Portable Bluetooth speaker with 10-hour battery.' },
        { name: 'AeroMini 4K GPS Drone', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQbKzVoYNwwVLAYsS6ieTg2isfJKnNXnI247w&s', priceUSD: 299, comparePriceUSD: 399, description: 'Compact drone with 4K camera and GPS stabilization.' },
        { name: 'LensPro Mirrorless Enthusiast Camera', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTeSUUWP4j-oRmqZZTuWgGfmhJxiDqnLe2rMQ&s', priceUSD: 449, comparePriceUSD: 549, description: 'Mirrorless camera with interchangeable lenses for enthusiasts.' },
        { name: 'MediaPad 10-inch Wi-Fi Tablet', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQwdOB9iJhi4AS34Qnt3Dc-Fm_z83kd_PHzSw&s', priceUSD: 329, comparePriceUSD: 429, description: '10" tablet with Wi-Fi, lightweight design for media consumption.' },
    ],
    Clothing: [
        { name: 'LuxeComfy Classic Cotton Tee', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcROcCyONZV_1TRqolok8G3_xW6tfG_y_J5gYQ&s', priceUSD: 19, comparePriceUSD: 29, description: 'Soft cotton tee with classic fit, available in multiple colors.' },
        { name: 'FlexDenim Slim-Fit Stretch Jeans', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQJGUSzUnreRb3BqejaJgPRFCHJCnYShi9Cww&s', priceUSD: 49, comparePriceUSD: 69, description: 'Slim-fit denim jeans with stretch for maximum comfort.' },
        { name: 'Willow Casual A-line Dress', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRj61iPK3AJUf8XhM4ZJRohqNWNUOQjHZHb8TafEHQVoydezGxDfcQWZsGzu9df708b4Ow&usqp=CAU', priceUSD: 79, comparePriceUSD: 109, description: 'Casual A-line dress in lightweight fabric, perfect for summer.' },
        { name: 'RibKnit Cozy Crewneck Sweater', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSDnfdXdKIOjZy5au9mE53T215ZBx_E7_Vsfg&s', priceUSD: 45, comparePriceUSD: 65, description: 'Cozy knit sweater with ribbed cuffs and soft fleece interior.' },
        { name: 'BreezeGuard Lightweight Windbreaker', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSifiH2li7zVXJXfm8EMVrtpEgK-gMRG4MZNg&s', priceUSD: 99, comparePriceUSD: 149, description: 'Lightweight windbreaker with water resistance and hood.' },
        { name: 'LoungeDraw Casual Cotton Shorts', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQGPVPv6n1SwBOy_16JcklnQXSE2pATtiSqI6a3wwu3MWRqEjqyPoH1-WTjvo7zNA7hfu8&usqp=CAU', priceUSD: 29, comparePriceUSD: 39, description: 'Casual cotton shorts with drawstring waist for ultimate relaxation.' },
        { name: 'FleeceCloud Pullover Hoodie', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS4pmMJqeFz4vCpLyNOBZNw_8g8B2pm7ogTzw&s', priceUSD: 49, comparePriceUSD: 79, description: 'Pullover hoodie with soft fleece interior and kangaroo pocket.' },
        { name: 'PiquÃ© Classic Breathable Polo', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ_etyIxJW6_cRx1cxAslsVq05XbVHuN8VJjQ&s', priceUSD: 29, comparePriceUSD: 49, description: 'Classic polo with breathable pique knit for a smart-casual look.' },
        { name: 'GalaHour Elegant Evening Gown', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRxsRezh0WXKTE6-j6jggxQ00QKJJI38uBArg&s', priceUSD: 129, comparePriceUSD: 199, description: 'Elegant evening dress with a stunning silhouette.' },
    ],
    'Home & Kitchen': [
        { name: 'DailyBrew 12-Cup Drip Maker', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSRtwWQIYPDLkAXoi67q_fsgdvXBKv9XFV2cw&s', priceUSD: 59, comparePriceUSD: 79, description: 'Drip coffee maker with 12-cup capacity and programmable timer.' },
        { name: 'SmoothMix 700W Countertop Blender', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTZRLbb4ueJTY29QYkoGVV6pA0yKikoTqcnxQ&s', priceUSD: 49, comparePriceUSD: 69, description: 'Countertop blender with 700W motor for smoothies and sauces.' },
        { name: 'QuickToast 2-Slice Toaster', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ0Us4KIJpgeXu4MMmB0l_h4o7lGD8LnE5UQA&s', priceUSD: 29, comparePriceUSD: 39, description: '2-slice toaster with adjustable browning settings and defrost function.' },
        { name: 'CounterQuick 700W Microwave', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTLnBieHEgsD_YLPd5PEiZCB28SeJuCC3wlnQ&s', priceUSD: 89, comparePriceUSD: 119, description: 'Compact countertop microwave with quick-cook functions.' },
        { name: 'NonStick 10-Piece Cookware Set', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR7WThvVIL0VI3E0JlVTApn2f6d_naQM3r4mg&s', priceUSD: 99, comparePriceUSD: 149, description: '10-piece nonstick cookware set for everyday cooking needs.' },
        { name: 'BlockBasic 6-Piece Stainless Knife Set', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRQ73Zpu54jCXKIAhB4zr7VhIq3Sbkqxu9QeQ&s', priceUSD: 49, comparePriceUSD: 79, description: '6-piece stainless steel knife set with wooden block.' },
        { name: 'FryQuick 4-Quart Digital Air Fryer', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTFlIHiHXHx_aLs34HN82PCtMXRT7u6_cB2ew&s', priceUSD: 79, comparePriceUSD: 119, description: '4-quart digital air fryer with preset cooking programs.' },
        { name: 'BakerStar 5-Quart Stand Mixer', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTI4q-VlAeFuO3xzJOJYWhe66Q0gHDTWFq9RQ&s', priceUSD: 199, comparePriceUSD: 299, description: '5-quart stand mixer for baking and mixing tasks.' },
        { name: 'ChillBase Top-Freezer Refrigerator', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTYTpVqo_0jcon6X5nQV0vuZMfCLemekwAbrA&s', priceUSD: 599, comparePriceUSD: 799, description: 'Top-freezer refrigerator with adjustable shelves.' },
    ],
    Books: [
        { name: 'The Unseen Threads (Modern Lit)', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRwe9xIQTqN7YbwUthsUG4AVHNjQ0sDTT5LgA&s', priceUSD: 14, comparePriceUSD: 18, description: 'Modern literary novel exploring relationships and identity.' },
        { name: 'Atomic Habits: The Productivity Guide', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTI5eUjkhd0b5X5Wwz5V3BHhoLdDKsvs3dKbg&s', priceUSD: 12, comparePriceUSD: 16, description: 'Practical self-help guide focused on habits and productivity.' },
        { name: 'Simple Suppers: Weeknight Recipes', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT36VCU4VBj15kaJCJBa2ntpByMs0Wie7cB-Q&s', priceUSD: 24, comparePriceUSD: 30, description: 'Beginner-friendly cookbook with simple weeknight recipes.' },
        { name: 'Foundations of Computer Science', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRcycy_36gv-asWxdCIQfN94rjTowuYfcAt1Q&s', priceUSD: 89, comparePriceUSD: 120, description: 'Comprehensive textbook for undergraduate courses.' },
    ],
    Beauty: [
        { name: 'HydroShield Daily Cream SPF 30', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQFgg12R9Wn7Jtwv5cxZscOBCOjFYIT09O3iw&s', priceUSD: 24, comparePriceUSD: 34, description: 'Hydrating daily face cream with SPF protection.' },
        { name: 'GentleClean Daily Normal Hair Shampoo', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRvqy399l4h8xrN6KznD77Jz8aemrrp8m8HLw&s', priceUSD: 12, comparePriceUSD: 16, description: 'Daily shampoo for normal hair with gentle cleansing.' },
        { name: 'Essential Starter Makeup Kit', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRXbavWu340ekiLr6ltZhZUfFaa6Y6MB8Thxg&s', priceUSD: 29, comparePriceUSD: 45, description: 'Starter makeup kit with essential palettes and brushes.' },
    ],
    Sports: [
        { name: 'CloudRun Cushioned Mesh Running Shoes', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQCWi1wCoXf_LQg-UEPB5fUsMTZEcwzGmySGw&s', priceUSD: 69, comparePriceUSD: 99, description: 'Cushioned running shoes with breathable mesh upper.' },
        { name: 'FlexiMat Lightweight Non-Slip Yoga Mat', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRyic_VMFyugghch_hIiRsmqPOWSwwJWbWUXQ&s', priceUSD: 19, comparePriceUSD: 29, description: 'Lightweight yoga mat with non-slip surface.' },
        { name: 'WeightMax Adjustable Dumbbell Set', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSwb1G321fYXpvd8EwTGtP2LTj1T8IWDp8law&s', priceUSD: 29, comparePriceUSD: 49, description: 'Set of adjustable dumbbells for home workouts.' },
        { name: 'OfficialPro Indoor/Outdoor Basketball', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT7PmYofUTujaZTzaFgqoKp2nhqCj4zr_QUUw&s', priceUSD: 25, comparePriceUSD: 35, description: 'Official size indoor/outdoor basketball with grip.' },
    ],
};


        const generateAllProducts = () => {
            let products = [];
            let id = 1;

            Object.keys(productDefinitions).forEach(category => {
                const categoryList = productDefinitions[category];
                // For a 250+ count, loop through the list several times, modifying slightly
                for (let j = 0; j < 6; j++) { // Loop 6 times
                    categoryList.forEach(p => {
                        const basePrice = p.priceUSD;
                        const price = basePrice - (Math.floor(Math.random() * 5) * (j % 2)); // slight variation/sale simulation
                        const comparePrice = p.comparePriceUSD;
                        const rating = (Math.floor(Math.random() * 15) + 30) / 10; // 3.0 to 4.5
                        const reviews = Math.floor(Math.random() * 500) + 10;
                        
                        products.push({
                            id: id++,
                            name: p.name + (j > 0 ? ` (Gen ${j})` : ''),
                            description: p.description,
                            price: price > 5 ? price : 5, // Minimum price of $5
                            comparePrice: comparePrice,
                            // Use the unique image URL from the definition
                            image: p.image + `&variation=${id}`, 
                            category: category,
                            rating: rating,
                            reviews: reviews,
                            isOnSale: price < comparePrice || Math.random() < 0.2
                        });
                    });
                }
            });
            // Shuffle and cap at 250 for display
            return products.sort(() => Math.random() - 0.5).slice(0, 250); 
        };

        // --- CORE APPLICATION CLASS ---
        class EcommerceStore {
            constructor() {
                this.products = generateAllProducts();
                this.cart = JSON.parse(localStorage.getItem('cart')) || [];
                this.user = JSON.parse(localStorage.getItem('user')) || null;
                this.currentPage = 'home';
                this.activeProductId = null; // Track which product is being viewed
                this.init();
            }

            init() {
                this.bindEvents();
                this.updateUI();
                this.loadProducts();
                this.renderDeals();
                this.startHeroSlider();
                this.startCountdown();
            }

            // --- State Management ---
            setState(newState) {
                Object.assign(this, newState);
                this.updateUI();
                this.saveState();
            }

            saveState() {
                localStorage.setItem('cart', JSON.stringify(this.cart));
                if (this.user) {
                    localStorage.setItem('user', JSON.stringify(this.user));
                } else {
                    localStorage.removeItem('user');
                }
            }

            // --- UI Updates ---
            updateUI() {
                this.updateCartCount();
                this.updateAuthUI();
                this.updatePage();
                this.updateProfile();
            }

            updateCartCount() {
                const count = this.cart.reduce((total, item) => total + item.quantity, 0);
                const cartCountEl = document.querySelector('.cart-count-badge');
                if (cartCountEl) {
                    cartCountEl.textContent = count;
                    cartCountEl.classList.toggle('hidden', count === 0);
                }
            }

            updateAuthUI() {
                const displayNameEl = document.getElementById('user-display-name');
                const accountStatusEl = document.getElementById('account-status');
                const authActionBtn = document.getElementById('auth-action-btn');
                const logoutLink = document.getElementById('logout-link');

                if (this.user) {
                    displayNameEl.textContent = this.user.name;
                    accountStatusEl.textContent = 'Hello, ' + this.user.name;
                    authActionBtn.style.display = 'none';
                    logoutLink.classList.remove('hidden');
                } else {
                    displayNameEl.textContent = 'Sign in';
                    accountStatusEl.textContent = 'Account';
                    authActionBtn.style.display = 'block';
                    authActionBtn.textContent = 'Sign In';
                    logoutLink.classList.add('hidden');
                }
            }

            updateProfile() {
                if (this.user) {
                    document.getElementById('profile-name').textContent = this.user.name;
                    document.getElementById('profile-email-info').textContent = this.user.email;
                    document.getElementById('profile-join-date').textContent = this.user.joinDate || 'Jan 2025';
                    document.getElementById('profile-cart-count').textContent = `${this.cart.length} items`;
                }
            }

            updatePage() {
                document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                const page = document.getElementById(this.currentPage);
                if (page) {
                    page.classList.add('active');
                }
                window.scrollTo(0, 0);
                if (this.currentPage === 'cart') this.renderCart();
            }

            // --- Navigation & Modals ---
            navigateTo(pageId) {
                if ((pageId === 'cart' || pageId === 'profile') && !this.user) {
                    this.showToast('Please log in to view this page.', 'warning');
                    this.showAuthModal();
                    return;
                }
                this.currentPage = pageId;
                this.updatePage();
            }

            showAuthModal() {
                const modal = document.getElementById('auth-modal');
                modal.style.display = 'flex';
                setTimeout(() => modal.querySelector('.modal-content').classList.add('active'), 10);
            }

            hideAuthModal() {
                const modal = document.getElementById('auth-modal');
                modal.querySelector('.modal-content').classList.remove('active');
                setTimeout(() => modal.style.display = 'none', 300);
            }

            // --- Product Rendering ---
            loadProducts() {
                this.renderProducts(this.products);
            }

            filterProducts(category) {
                const filtered = category === 'all' ? this.products : this.products.filter(p => p.category === category);
                this.renderProducts(filtered);
            }

            renderStars(rating) {
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;
                const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
                
                return '<span class="text-yellow-500">' + 'â˜…'.repeat(fullStars) + (hasHalfStar ? 'Â½' : '') + '</span>' + 
                       '<span class="text-gray-300">' + 'â˜…'.repeat(emptyStars) + '</span>';
            }

            renderProducts(productsToRender) {
                const container = document.getElementById('products-container');
                if (!container) return;
                
                container.innerHTML = productsToRender.map(product => `
                    <div class="product-card bg-white p-4 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 cursor-pointer group" data-id="${product.id}">
                        <div class="product-image h-48 mb-4 overflow-hidden rounded-lg">
                            <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" onerror="this.onerror=null; this.src='https://placehold.co/600x400/FF9900/131921?text=Product';">
                        </div>
                        <div class="product-info">
                            <h3 class="text-lg font-semibold text-gray-800 mb-1 line-clamp-2">${product.name}</h3>
                            <p class="text-xs text-gray-500 mb-2">${product.category}</p>
                            <div class="flex items-center justify-between mb-3">
                                <div class="product-rating flex text-sm">
                                    ${this.renderStars(product.rating)}
                                </div>
                                <span class="text-xs text-gray-400">(${product.reviews} reviews)</span>
                            </div>
                            <div class="product-price-section mb-3">
                                <span class="product-price text-xl font-extrabold text-red-600">$${product.price.toFixed(2)}</span>
                                ${product.comparePrice ? `<span class="product-compare-price text-sm text-gray-400 line-through ml-2">$${product.comparePrice.toFixed(2)}</span>` : ''}
                            </div>
                            <button class="add-to-cart-home w-full bg-blue-600 text-white p-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors" data-id="${product.id}">
                                <i class="fas fa-shopping-cart"></i> Add to Cart
                            </button>
                        </div>
                    </div>
                `).join('');
                
                this.bindProductCardEvents();
            }

            bindProductCardEvents() {
                 // Add event listeners to add to cart buttons
                document.querySelectorAll('.add-to-cart-home').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent the parent card click
                        const id = parseInt(e.currentTarget.dataset.id);
                        const product = this.products.find(p => p.id === id);
                        if (product) {
                            this.addToCart(product, 1);
                        }
                    });
                });

                // Add event listeners to product cards for viewing details
                document.querySelectorAll('.product-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const id = parseInt(card.dataset.id);
                        this.viewProduct(id);
                    });
                });
            }

            viewProduct(productId) {
                const product = this.products.find(p => p.id === productId);
                if (product) {
                    this.activeProductId = productId; // Set the active product
                    document.getElementById('product-image').src = product.image;
                    document.getElementById('product-name').textContent = product.name;
                    document.getElementById('product-name-breadcrumb').textContent = product.name;
                    document.getElementById('product-category-breadcrumb').textContent = product.category;
                    document.getElementById('product-category-tag').textContent = product.category;
                    document.getElementById('product-stars').innerHTML = this.renderStars(product.rating);
                    document.getElementById('product-reviews').textContent = `(${product.reviews} reviews)`;
                    document.getElementById('product-price').textContent = `$${product.price.toFixed(2)}`;
                    
                    const comparePriceEl = document.getElementById('product-compare-price');
                    comparePriceEl.textContent = product.comparePrice ? `$${product.comparePrice.toFixed(2)}` : '';
                    comparePriceEl.classList.toggle('hidden', !product.comparePrice);

                    document.getElementById('product-description').textContent = product.description;
                    document.getElementById('product-quantity').value = 1;
                    
                    this.navigateTo('product');
                }
            }

            // --- Cart Logic ---
            addToCart(product, quantity) {
                if (!this.user) {
                    this.showToast('Please log in to add items to your cart.', 'warning');
                    this.showAuthModal();
                    return;
                }

                const existingItem = this.cart.find(item => item.id === product.id);
                
                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    this.cart.push({
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        comparePrice: product.comparePrice,
                        image: product.image,
                        quantity: quantity
                    });
                }
                
                this.setState({ cart: this.cart });
                this.showToast('Product added to cart!', 'success');
            }

            updateCartItem(id, quantity) {
                if (quantity <= 0) {
                    this.removeItem(id);
                    return;
                }
                
                const item = this.cart.find(item => item.id === id);
                if (item) {
                    item.quantity = quantity;
                    this.setState({ cart: this.cart });
                }
            }

            removeItem(id) {
                this.cart = this.cart.filter(item => item.id !== id);
                this.setState({ cart: this.cart });
                this.showToast('Item removed from cart', 'info');
            }

            clearCart() {
                this.cart = [];
                this.setState({ cart: this.cart });
                this.showToast('Cart cleared successfully', 'info');
            }

            getCartTotal() {
                return this.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            }

            renderCart() {
                const container = document.getElementById('cart-items');
                const emptyMessage = document.getElementById('cart-empty-message');
                const cartContent = document.querySelector('.grid-cols-3 > div:first-child');
                
                if (!container || !emptyMessage || !cartContent) return;

                if (this.cart.length === 0) {
                    container.innerHTML = '';
                    emptyMessage.classList.remove('hidden');
                    cartContent.classList.add('hidden');
                } else {
                    emptyMessage.classList.add('hidden');
                    cartContent.classList.remove('hidden');
                    container.innerHTML = this.cart.map(item => `
                        <div class="cart-item flex items-center gap-4 py-4" data-id="${item.id}">
                            <img src="${item.image}" alt="${item.name}" class="w-24 h-24 object-cover rounded-lg flex-shrink-0" onerror="this.onerror=null; this.src='https://placehold.co/96x96/FF9900/131921?text=Item';">
                            <div class="flex-grow">
                                <h3 class="text-lg font-semibold text-gray-800">${item.name}</h3>
                                <p class="text-sm text-gray-500">Price: <span class="font-medium text-red-600">$${item.price.toFixed(2)}</span></p>
                                <div class="cart-item-actions flex items-center mt-2">
                                    <div class="cart-quantity flex items-stretch border border-gray-300 rounded-md overflow-hidden">
                                        <button class="cart-qty-btn decrease w-8 h-8 bg-gray-100 hover:bg-gray-200 text-lg font-bold transition-colors" data-id="${item.id}">-</button>
                                        <input type="number" class="cart-qty-input w-8 h-8 text-center text-sm font-semibold border-x border-gray-300 focus:outline-none" value="${item.quantity}" min="1" data-id="${item.id}">
                                        <button class="cart-qty-btn increase w-8 h-8 bg-gray-100 hover:bg-gray-200 text-lg font-bold transition-colors" data-id="${item.id}">+</button>
                                    </div>
                                    <button class="remove-item ml-4 text-red-500 hover:text-red-700 transition-colors" data-id="${item.id}">
                                        <i class="fas fa-trash-alt"></i> Remove
                                    </button>
                                </div>
                            </div>
                            <div class="cart-item-total text-xl font-extrabold text-gray-800">$${(item.price * item.quantity).toFixed(2)}</div>
                        </div>
                    `).join('');
                    
                    // Re-bind cart controls
                    this.bindCartControls();
                }
                
                // Update totals
                const subtotal = this.getCartTotal();
                const taxRate = 0.08;
                const tax = subtotal * taxRate;
                const total = subtotal + tax;
                
                document.getElementById('cart-subtotal').textContent = `$${subtotal.toFixed(2)}`;
                document.getElementById('cart-tax').textContent = `$${tax.toFixed(2)}`;
                document.getElementById('cart-total').textContent = `$${total.toFixed(2)}`;
            }

            bindCartControls() {
                document.querySelectorAll('.decrease').forEach(btn => {
                    btn.onclick = (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        const item = this.cart.find(item => item.id === id);
                        if (item && item.quantity > 1) this.updateCartItem(id, item.quantity - 1);
                        else if (item) this.removeItem(id);
                    };
                });
                document.querySelectorAll('.increase').forEach(btn => {
                    btn.onclick = (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        const item = this.cart.find(item => item.id === id);
                        if (item) this.updateCartItem(id, item.quantity + 1);
                    };
                });
                document.querySelectorAll('.cart-qty-input').forEach(input => {
                    input.onchange = (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        const quantity = parseInt(e.currentTarget.value) || 1;
                        this.updateCartItem(id, quantity);
                    };
                });
                document.querySelectorAll('.remove-item').forEach(btn => {
                    btn.onclick = (e) => this.removeItem(parseInt(e.currentTarget.dataset.id));
                });
            }

            // --- Authentication ---
            login(email, password) {
                if (email && password) {
                    this.user = {
                        email: email,
                        name: email.split('@')[0].split('.').map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(' '),
                        joinDate: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long' })
                    };
                    this.setState({ user: this.user });
                    this.hideAuthModal();
                    this.showToast('Login successful! Welcome back.', 'success');
                } else {
                    this.showToast('Invalid credentials. Try "test@user.com" and "password"', 'error');
                }
            }

            register(name, email, password) {
                if (name && email && password) {
                    this.user = {
                        email: email,
                        name: name,
                        joinDate: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long' })
                    };
                    this.setState({ user: this.user });
                    this.hideAuthModal();
                    this.showToast(`Welcome, ${name}! Registration successful.`, 'success');
                } else {
                    this.showToast('Please fill all registration fields.', 'error');
                }
            }
            
            logout() {
                this.user = null;
                this.setState({ user: null, cart: [] });
                this.showToast('Logged out successfully.', 'info');
                this.navigateTo('home');
            }

            // --- Checkout ---
            checkout() {
                if (this.cart.length === 0) {
                    this.showToast('Your cart is empty! Add items before checking out.', 'warning');
                    return;
                }
                
                const paymentMethod = document.querySelector('input[name="payment"]:checked')?.value || 'gpay';
                const total = this.getCartTotal() * 1.08; 
                
                document.getElementById('order-id').textContent = `NEXUS-${new Date().getFullYear()}-${Math.floor(Math.random() * 900) + 100}`;
                document.getElementById('order-total').textContent = `$${total.toFixed(2)}`;
                document.getElementById('order-payment').textContent = paymentMethod === 'gpay' ? 'GPay' : paymentMethod === 'paypal' ? 'PayPal' : 'Credit Card';
                
                const modal = document.getElementById('checkout-success');
                modal.style.display = 'flex';
                setTimeout(() => modal.querySelector('.modal-content').classList.add('active'), 10);

                setTimeout(() => {
                    this.cart = [];
                    this.setState({ cart: this.cart });
                }, 1000);
            }

            closeCheckoutSuccess() {
                const modal = document.getElementById('checkout-success');
                modal.querySelector('.modal-content').classList.remove('active');
                setTimeout(() => modal.style.display = 'none', 300);
                this.navigateTo('home');
            }

            // --- Utility Components ---
            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 10);
                setTimeout(() => toast.classList.remove('show'), 3000);
                setTimeout(() => toast.remove(), 3300);
            }

            // --- Home Page Dynamics ---
            startHeroSlider() {
                let currentSlide = 0;
                const slides = document.querySelectorAll('.hero-slide');
                const dots = document.querySelectorAll('.hero-dots .dot');
                const totalSlides = slides.length;

                const showSlide = (index) => {
                    slides.forEach((s, i) => s.classList.toggle('active', i === index));
                    dots.forEach((d, i) => d.classList.toggle('bg-white', i === index));
                    dots.forEach((d, i) => d.classList.toggle('bg-white/50', i !== index));
                    currentSlide = index;
                };

                dots.forEach((dot) => {
                    dot.addEventListener('click', (e) => {
                        showSlide(parseInt(e.target.dataset.slide));
                        // Reset interval when user manually clicks
                        clearInterval(this.sliderInterval); 
                        this.sliderInterval = setInterval(nextSlide, 5000);
                    });
                });

                const nextSlide = () => {
                    currentSlide = (currentSlide + 1) % totalSlides;
                    showSlide(currentSlide);
                };

                this.sliderInterval = setInterval(nextSlide, 5000);
                showSlide(0);
            }

            startCountdown() {
                const countdownElements = {
                    hours: document.getElementById('hours'),
                    minutes: document.getElementById('minutes'),
                    seconds: document.getElementById('seconds'),
                };

                const updateTime = () => {
                    const now = new Date();
                    const endOfDay = new Date(now);
                    endOfDay.setHours(24, 0, 0, 0); 
                    const diff = endOfDay.getTime() - now.getTime();

                    let h = Math.floor(diff / (1000 * 60 * 60));
                    let m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    let s = Math.floor((diff % (1000 * 60)) / 1000);

                    if (countdownElements.hours) {
                        countdownElements.hours.textContent = h.toString().padStart(2, '0');
                        countdownElements.minutes.textContent = m.toString().padStart(2, '0');
                        countdownElements.seconds.textContent = s.toString().padStart(2, '0');
                    }
                };

                setInterval(updateTime, 1000);
                updateTime(); // Initial call
            }

            renderDeals() {
                const deals = this.products
                    .filter(p => p.isOnSale && p.price < p.comparePrice)
                    .sort(() => Math.random() - 0.5)
                    .slice(0, 4); 

                const container = document.getElementById('deals-container');
                if (!container) return;

                container.innerHTML = deals.map(deal => {
                    const percentOff = Math.floor(((deal.comparePrice - deal.price) / deal.comparePrice) * 100);
                    const claimed = Math.floor(Math.random() * 40) + 50; // 50% to 90% claimed
                    return `
                        <div class="deal-card bg-white p-4 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 cursor-pointer border border-gray-200" data-id="${deal.id}" onclick="store.viewProduct(${deal.id})">
                            <div class="deal-image h-32 mb-4 relative overflow-hidden rounded-lg">
                                <img src="${deal.image}" alt="${deal.name}" class="w-full h-full object-cover transition-transform duration-500" onerror="this.onerror=null; this.src='https://placehold.co/600x400/FF9900/131921?text=Deal';">
                                <div class="deal-badge absolute top-2 right-2 bg-red-600 text-white text-xs font-bold px-2 py-0.5 rounded-full">${percentOff}% OFF</div>
                            </div>
                            <div class="deal-info">
                                <h3 class="text-md font-bold text-gray-800 line-clamp-2">${deal.name}</h3>
                                <div class="deal-price flex items-center gap-2 my-2">
                                    <span class="current-price text-xl font-extrabold text-red-600">$${deal.price.toFixed(2)}</span>
                                    <span class="original-price text-sm text-gray-400 line-through">$${deal.comparePrice.toFixed(2)}</span>
                                </div>
                                <div class="deal-progress mt-3">
                                    <div class="progress-bar w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                                        <div class="progress-fill h-full bg-red-500 rounded-full" style="width: ${claimed}%;"></div>
                                    </div>
                                    <span class="progress-text text-xs text-gray-500 mt-1 block">${claimed}% claimed - Hurry!</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // --- Event Binding ---
            bindEvents() {
                // Global Navigation
                window.navigateTo = (page) => this.navigateTo(page);
                window.filterCategory = (category) => {
                    this.filterProducts(category);
                    document.querySelectorAll('.category-btn').forEach(btn => {
                        btn.classList.toggle('bg-white', btn.dataset.category !== category);
                        btn.classList.toggle('text-gray-800', btn.dataset.category !== category);
                        btn.classList.toggle('bg-[--primary]', btn.dataset.category === category);
                        btn.classList.toggle('text-white', btn.dataset.category === category);
                    });
                };
                window.showAuthModal = () => this.showAuthModal();
                window.handleAuthAction = () => {
                    if (this.user) this.logout();
                    else this.showAuthModal();
                };

                // Category Filters on Home Page
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        window.filterCategory(e.currentTarget.dataset.category);
                    });
                });
                
                // Auth Modal Events
                document.querySelector('#auth-modal .close-modal').onclick = () => this.hideAuthModal();
                document.getElementById('auth-modal').onclick = (e) => { if (e.target.id === 'auth-modal') this.hideAuthModal(); };
                
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.onclick = () => {
                        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active', 'text-blue-600', 'border-blue-600'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                        btn.classList.add('active', 'text-blue-600', 'border-blue-600');
                        document.getElementById(`${btn.dataset.tab}-tab`).classList.remove('hidden');
                    };
                });
                
                document.getElementById('login-form').onsubmit = (e) => {
                    e.preventDefault();
                    this.login(document.getElementById('login-email').value, document.getElementById('login-password').value);
                };
                document.getElementById('register-form').onsubmit = (e) => {
                    e.preventDefault();
                    this.register(document.getElementById('register-name').value, document.getElementById('register-email').value, document.getElementById('register-password').value);
                };
                
                // Checkout Button
                document.getElementById('checkout-btn').onclick = () => this.checkout();

                // Product Page Controls (Assuming Product Page is active)
                document.getElementById('add-to-cart').onclick = () => {
                    const product = this.products.find(p => p.id === this.activeProductId);
                    const qty = parseInt(document.getElementById('product-quantity').value);
                    if (product && qty > 0) this.addToCart(product, qty);
                };

                document.getElementById('increase-qty').onclick = () => {
                    const qtyInput = document.getElementById('product-quantity');
                    qtyInput.value = parseInt(qtyInput.value) + 1;
                };

                document.getElementById('decrease-qty').onclick = () => {
                    const qtyInput = document.getElementById('product-quantity');
                    if (parseInt(qtyInput.value) > 1) qtyInput.value = parseInt(qtyInput.value) - 1;
                };

                // Initial active category for visual feedback
                window.filterCategory('all');
            }
        }

        // Initialize store when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.store = new EcommerceStore();
        });
    </script>
</body>
</html>
